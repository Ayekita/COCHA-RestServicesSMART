package com.cocha.lineacredito.business;

import java.sql.Connection;

import com.cocha.lineacredito.dao.SqlSmartDao;
import com.cocha.lineacredito.dto.datosSalidaDTO;
import com.cocha.lineacredito.utiles.FechasUtil;

public class ControlFacturacionFinanzas {
	public static long fechaActual = FechasUtil.getFechaAtual();
	public static long horaActual = FechasUtil.getHoraAtual();

	public static void main(String[] args) throws Exception {				
		//String urlSmart = "jdbc:unisys:dmsql:Unisys.DMSII:resource=SMARTDB;host=libra4090;port=1897;user=cocha2;password=iquique3250"; 
		String urlSmart = "jdbc:unisys:dmsql:Unisys.DMSII:resource=SMARTQADB;host=libra460;port=1897;user=cochaqa;password=qa"; 
		String driverSmart = "com.unisys.jdbc.dmsql.Driver";

		String nemo = "DAVEY";
		String negocio = "7-I92-500";
		int pedido = 395914;

		Connection con = null;
		System.out.println(controlFacturacion(driverSmart, urlSmart, negocio, pedido, nemo, con));
	}

	public static String controlFacturacion(String driverSmart, String urlSmart, String negocio, int pedido, String nemo, Connection con) throws Exception{
		String status = "ERROR al actualizar el pedido";
		SqlSmartDao sqlSmart = new SqlSmartDao();
		datosSalidaDTO salida = sqlSmart.obtieneLineaCredito(nemo, con);
		int rutCli = salida.getRut();
		String usuario = "ONLINE";
		String existe = sqlSmart.existeNegPed(negocio, pedido, con);

		if(existe.equals("Existe")){
			if(sqlSmart.controlFinanzasPedido(negocio, pedido, fechaActual, horaActual, usuario, rutCli, con)){
				status = "OK pedido actualizado";		
			}
		}
		else {
			status = existe;
		}
		return status;
	}
}
